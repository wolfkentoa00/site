<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Liquid OS">

    <title>Pristine Liquid OS</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --light-x: 50%;
            --light-y: 50%;
            --shine-angle: 135deg;
            --rot-x: 0deg;
            --rot-y: 0deg;
            --rim-x: 0px;
            --rim-y: 0px;
        }

        body {
            margin: 0;
            padding: 0;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            font-family: -apple-system, SF Pro Text, sans-serif;
            background: #000;
            user-select: none;
            -webkit-user-select: none;
        }

        /* --- 1. DYNAMIC APPLE BACKGROUND --- */
        .wallpaper {
            position: absolute;
            top: -25%; left: -25%;
            width: 150%; height: 150%;
            /* Sophisticated Mesh Gradient */
            background: radial-gradient(at 0% 0%, rgba(255, 169, 249, 0.5) 0px, transparent 50%),
                        radial-gradient(at 100% 0%, rgba(100, 220, 255, 0.5) 0px, transparent 50%),
                        radial-gradient(at 100% 100%, rgba(150, 100, 255, 0.5) 0px, transparent 50%),
                        radial-gradient(at 0% 100%, rgba(255, 100, 100, 0.5) 0px, transparent 50%),
                        #000;
            filter: blur(40px);
            z-index: 0;
            transition: transform 0.1s linear;
            transform: translate(var(--rim-x), var(--rim-y)); /* Subtle parallax */
        }

        /* --- 2. GRID LAYOUT --- */
        .app-grid {
            position: absolute;
            top: 60px;
            width: 100%;
            height: calc(100% - 100px);
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 Columns like iOS */
            grid-auto-rows: 90px;
            gap: 15px 10px; /* Row Gap, Col Gap */
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            z-index: 10;
            /* Hide scrollbar */
            scrollbar-width: none; 
        }
        .app-grid::-webkit-scrollbar { display: none; }

        /* --- 3. THE GLASS APP ICON --- */
        .app-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            animation: popIn 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        @keyframes popIn {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .glass-block {
            width: 68px; /* Standard iOS size approximation */
            height: 68px;
            border-radius: 18px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            
            /* The "Pristine" Glass Material */
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px) saturate(160%);
            -webkit-backdrop-filter: blur(20px) saturate(160%);
            border: 1px solid rgba(255, 255, 255, 0.15);
            
            /* Internal Refraction (Light catching edges) */
            box-shadow: 
                inset var(--rim-x) var(--rim-y) 8px rgba(255, 255, 255, 0.5),
                0 4px 12px rgba(0,0,0,0.2);
            
            transition: transform 0.1s;
        }

        .glass-block:active {
            transform: scale(0.92);
            filter: brightness(0.8);
        }

        /* The Shiny Glint Overlay */
        .glass-block::after {
            content: '';
            position: absolute;
            inset: 0; border-radius: 18px; padding: 1px;
            background: radial-gradient(circle at var(--light-x) var(--light-y), rgba(255, 255, 255, 0.9) 0%, transparent 40%);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude;
            pointer-events: none;
        }

        /* The Metallic/Glass Icon inside */
        .tinted-icon {
            font-size: 32px;
            z-index: 5;
            color: transparent;
            
            /* Metallic Gradient Fill */
            background: linear-gradient(
                var(--shine-angle), 
                var(--c-dark) 10%, 
                var(--c-light) 50%,
                var(--c-dark) 90%
            );
            background-size: 200% 200%;
            background-position: var(--light-x) var(--light-y);
            -webkit-background-clip: text;
            
            /* Shadow to lift it off the glass */
            filter: drop-shadow(0 2px 4px var(--c-glow));
        }

        .label {
            margin-top: 6px;
            font-size: 11px;
            color: white;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 70px;
        }

        /* --- 4. EDIT MODE (WIGGLE) --- */
        @keyframes wiggle {
            0% { transform: rotate(0deg); }
            25% { transform: rotate(-2deg); }
            50% { transform: rotate(0deg); }
            75% { transform: rotate(2deg); }
            100% { transform: rotate(0deg); }
        }

        .editing .glass-block {
            animation: wiggle 0.25s linear infinite;
            border: 1px solid rgba(255,255,255,0.4); /* Highlight border */
        }
        
        .selected .glass-block {
            background: rgba(255,255,255,0.3);
            box-shadow: 0 0 15px white;
            animation: none; /* Stop wiggling if selected for swap */
            transform: scale(1.1);
        }

        /* Delete Badge (Visual only for now) */
        .delete-badge {
            display: none;
            position: absolute;
            top: -5px; left: -5px;
            width: 20px; height: 20px;
            background: rgba(255,255,255,0.8);
            border-radius: 50%;
            color: black;
            font-size: 12px;
            align-items: center;
            justify-content: center;
            z-index: 20;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .editing .delete-badge { display: flex; }

        /* --- 5. UI CONTROLS --- */
        .control-bar {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 20px;
            z-index: 100;
        }

        .btn {
            padding: 12px 24px;
            background: rgba(30, 30, 30, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 30px;
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
        }
        .btn.primary { background: rgba(255, 255, 255, 0.2); color: white; }

    </style>
</head>
<body>

    <div class="wallpaper"></div>
    
    <div class="app-grid" id="grid">
        </div>

    <div class="control-bar">
        <button class="btn" onclick="toggleEdit()">Edit Home Screen</button>
        <button class="btn primary" id="perm-btn" onclick="initGyro()">Enable Motion</button>
        <button class="btn" onclick="addApp()" style="display:none;" id="add-btn">+</button>
    </div>

    <script>
        // --- 1. APP DATA DEFINITION ---
        // Pre-defined list of pristine apps with specific FontAwesome icons and Brand Colors
        const defaultApps = [
            { name: "Phone", icon: "fas fa-phone", dark: "#2ecc71", light: "#a3e4d7" },
            { name: "Messages", icon: "fas fa-comment", dark: "#2ecc71", light: "#a3e4d7" },
            { name: "Safari", icon: "fas fa-compass", dark: "#3498db", light: "#aed6f1" },
            { name: "Music", icon: "fas fa-music", dark: "#e74c3c", light: "#fadbd8" },
            { name: "Photos", icon: "fas fa-images", dark: "#f1c40f", light: "#f9e79f" },
            { name: "Camera", icon: "fas fa-camera", dark: "#7f8c8d", light: "#bdc3c7" },
            { name: "Settings", icon: "fas fa-cog", dark: "#95a5a6", light: "#d0d3d4" },
            { name: "Snapchat", icon: "fab fa-snapchat-ghost", dark: "#f1c40f", light: "#fff" },
            { name: "TikTok", icon: "fab fa-tiktok", dark: "#2c3e50", light: "#e74c3c" },
            { name: "Instagram", icon: "fab fa-instagram", dark: "#8e44ad", light: "#e91e63" },
            { name: "YouTube", icon: "fab fa-youtube", dark: "#c0392b", light: "#e74c3c" },
            { name: "X", icon: "fab fa-twitter", dark: "#000000", light: "#ffffff" }, // X is tricky, used Twitter icon
            { name: "Spotify", icon: "fab fa-spotify", dark: "#27ae60", light: "#2ecc71" },
            { name: "Netflix", icon: "fas fa-play", dark: "#c0392b", light: "#e74c3c" },
            { name: "Discord", icon: "fab fa-discord", dark: "#5865F2", light: "#7289da" },
            { name: "WhatsApp", icon: "fab fa-whatsapp", dark: "#25D366", light: "#2ecc71" },
            { name: "FaceTime", icon: "fas fa-video", dark: "#2ecc71", light: "#a3e4d7" },
            { name: "Maps", icon: "fas fa-map-marked-alt", dark: "#e67e22", light: "#f39c12" },
            { name: "Wallet", icon: "fas fa-wallet", dark: "#2c3e50", light: "#34495e" },
            { name: "Weather", icon: "fas fa-cloud-sun", dark: "#3498db", light: "#85c1e9" },
        ];

        let apps = [];
        let isEditing = false;
        let selectedIndex = null;

        // --- 2. INITIALIZATION & RENDERING ---
        
        function init() {
            // Load from LocalStorage or use default
            const saved = localStorage.getItem('liquidLayout');
            if (saved) {
                apps = JSON.parse(saved);
            } else {
                apps = [...defaultApps];
            }
            render();
        }

        function render() {
            const grid = document.getElementById('grid');
            grid.innerHTML = ''; // Clear

            apps.forEach((app, index) => {
                const div = document.createElement('div');
                div.className = 'app-container';
                if (selectedIndex === index) div.classList.add('selected');
                
                // OnClick Logic
                div.onclick = () => handleAppClick(index);

                // Long Press Logic
                let timer;
                div.addEventListener('touchstart', () => { 
                    timer = setTimeout(() => { if(!isEditing) toggleEdit(); }, 800); 
                });
                div.addEventListener('touchend', () => clearTimeout(timer));

                // HTML Structure
                div.innerHTML = `
                    <div class="glass-block" style="--c-dark: ${app.dark}; --c-light: ${app.light}; --c-glow: ${app.dark}80;">
                        <div class="delete-badge" onclick="removeApp(event, ${index})"><i class="fas fa-minus"></i></div>
                        <i class="${app.icon} tinted-icon"></i>
                    </div>
                    <span class="label">${app.name}</span>
                `;
                grid.appendChild(div);
            });
        }

        // --- 3. INTERACTION LOGIC ---

        function handleAppClick(index) {
            if (isEditing) {
                // Swap Logic
                if (selectedIndex === null) {
                    // Select first item
                    selectedIndex = index;
                    render();
                } else if (selectedIndex === index) {
                    // Deselect
                    selectedIndex = null;
                    render();
                } else {
                    // Swap
                    const temp = apps[selectedIndex];
                    apps[selectedIndex] = apps[index];
                    apps[index] = temp;
                    selectedIndex = null;
                    save();
                    render();
                }
            } else {
                // Normal Mode: Open App
                // Since these are fake, we just wobble the screen or alert
                // In a real version, this would be: window.location.href = app.url;
                
                // Try to open generic scheme
                const scheme = apps[index].name.toLowerCase() + "://";
                // alert("Opening " + apps[index].name);
                window.location.href = scheme; 
            }
        }

        function toggleEdit() {
            isEditing = !isEditing;
            const grid = document.getElementById('grid');
            const addBtn = document.getElementById('add-btn');
            
            if (isEditing) {
                grid.classList.add('editing');
                addBtn.style.display = 'block';
                document.querySelector('.btn').innerText = "Done";
            } else {
                grid.classList.remove('editing');
                selectedIndex = null;
                addBtn.style.display = 'none';
                document.querySelector('.btn').innerText = "Edit Home Screen";
                render(); // Clear selection visuals
            }
        }

        function addApp() {
            // Adds a generic app for demo purposes
            apps.push({ 
                name: "New App", 
                icon: "fas fa-star", 
                dark: "#ffffff", 
                light: "#ffffff" 
            });
            save();
            render();
            // Scroll to bottom
            setTimeout(() => {
                const grid = document.getElementById('grid');
                grid.scrollTop = grid.scrollHeight;
            }, 100);
        }

        function removeApp(e, index) {
            e.stopPropagation(); // Prevent clicking the app itself
            if(confirm("Delete " + apps[index].name + "?")) {
                apps.splice(index, 1);
                save();
                render();
            }
        }

        function save() {
            localStorage.setItem('liquidLayout', JSON.stringify(apps));
        }

        // --- 4. GYROSCOPE PHYSICS (REFINED) ---
        
        function initGyro() {
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                DeviceOrientationEvent.requestPermission().then(p => {
                    if (p === 'granted') { 
                        document.getElementById('perm-btn').style.display = 'none'; 
                        window.addEventListener('deviceorientation', handleMotion); 
                    }
                });
            } else {
                document.getElementById('perm-btn').style.display = 'none'; 
                window.addEventListener('deviceorientation', handleMotion);
            }
        }

        let curX = 0, curY = 0;
        let tarX = 0, tarY = 0;

        function animateLoop() {
            // Smooth Interpolation
            curX += (tarX - curX) * 0.1;
            curY += (tarY - curY) * 0.1;

            const root = document.documentElement;
            
            // Lighting Variables
            const lightX = 50 + (curX * 1.5); 
            const lightY = 50 + (curY * 1.5);
            const angle = 135 + (curX);

            // Rim Light (Inner Shadow)
            const rimX = (curX / 3) * -1;
            const rimY = (curY / 3) * -1;

            root.style.setProperty('--light-x', `${lightX}%`);
            root.style.setProperty('--light-y', `${lightY}%`);
            root.style.setProperty('--rim-x', `${rimX}px`);
            root.style.setProperty('--rim-y', `${rimY}px`);
            root.style.setProperty('--shine-angle', `${angle}deg`);

            requestAnimationFrame(animateLoop);
        }
        animateLoop();

        function handleMotion(event) {
            let x = event.gamma; // -90 to 90
            let y = event.beta;  // -180 to 180
            
            // Calibration for holding phone upright
            y = y - 45;

            // Clamp
            if (x > 45) x = 45; if (x < -45) x = -45;
            if (y > 45) y = 45; if (y < -45) y = -45;

            tarX = x; 
            tarY = y;
        }

        // Run on load
        init();

    </script>
</body>
</html>
